<div class="textflex">



  <div id="huntran" contenteditable="true" onkeydown="handleKeyPress(event)" onmouseup="getCursorPosition()">
    f
  </div>

</div>
<script>
  function handleKeyPress(event) {
    const huntranDiv = document.getElementById('huntran');
    var selection = window.getSelection();
    if (selection.rangeCount > 0) {
      var range = selection.getRangeAt(0);

      // Lấy vị trí của con trỏ
      var cursorPosition = range.startOffset;

      // Lấy văn bản phía trước
      //var textBeforeCursor = range.startContainer.textContent.slice(0, cursorPosition);

      // Lấy văn bản phía sau
      var textAfterCursor = range.startContainer.textContent.slice(cursorPosition);
      if (textAfterCursor.includes(' ')) {
        // Văn bản phía sau chứa khoảng trắng
        console.log('Text after cursor contains a space.');
      } else {
        // Văn bản phía sau không chứa khoảng trắng
        console.log('Text after cursor does not contain a space.');
      }
    }


    // Kiểm tra xem phần tử có focus không
    if (document.activeElement === huntranDiv && huntranDiv.contentEditable === 'true') {
    if (event.key === ' ') {
      var huntran = document.getElementById('huntran');
      var textAfterCursor = range.startContainer.textContent.slice(cursorPosition);

      // Kiểm tra xem văn bản phía sau chứa khoảng trắng hay không
      if (textAfterCursor.includes(' ')) {
        // Tạo một phạm vi từ vị trí con trỏ
        var newRange = document.createRange();
        newRange.setStart(range.startContainer, cursorPosition);
        newRange.setEnd(range.startContainer, cursorPosition);

        // Tạo một đối tượng div để chứa cấu trúc HTML mới
        var newContent = document.createElement('div');
        newContent.className = 'autocomplete';
        newContent.innerHTML = '<span contenteditable="true" id="textdiv"></span>';

        newRange.insertNode(newContent);
        var textDiv = document.getElementById('textdiv');
        
        textDiv.focus();

        // Xử lý tiếp theo nếu cần
        autocomplete(textDiv, Teacher);
        huntranDiv.contentEditable = false;
        DiChuyenDenCuoi(textDiv);
        textDiv.addEventListener('blur', function() {
          newContent.remove();
            
        });
    }
  }
}

  }
</script>

{{>Autocompletecopy}}

<script>
  function DiChuyenDenCuoi(element) {
    var range = document.createRange();
    var selection = window.getSelection();
    range.selectNodeContents(element);
    range.collapse(false);
    selection.removeAllRanges();
    selection.addRange(range);
  }

</script>
<script>
  function getCursorPosition() {
    // Lấy đối tượng chứa văn bản có thể chỉnh sửa
    var editableDiv = document.getElementById('huntran');

    // Tạo đối tượng Selection từ vùng được chọn hoặc con trỏ
    var selection = window.getSelection();

    // Kiểm tra xem có văn bản được chọn không
    if (selection.rangeCount > 0) {
      var range = selection.getRangeAt(0);

      // Lấy vị trí của con trỏ
      var cursorPosition = range.startOffset;

      // In ra console vị trí của con trỏ
      console.log('Cursor position:', cursorPosition);

      // Lấy văn bản phía trước
      var textBeforeCursor = range.startContainer.textContent.slice(0, cursorPosition);
      console.log('Text before cursor:', textBeforeCursor);

      // Lấy văn bản phía sau
      var textAfterCursor = range.startContainer.textContent.slice(cursorPosition);
      console.log('Text after cursor:', textAfterCursor);
    }
  }
</script>