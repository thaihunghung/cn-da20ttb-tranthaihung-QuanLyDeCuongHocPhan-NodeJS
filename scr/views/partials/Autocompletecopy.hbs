<script>
    var Teacher = [
        'Nguyễn Thái Sơn',
        'Võ Phước Hưng',
        'Phan Quốc Nghĩa',
        'Nguyễn Trần Diễm Hạnh',
        'Nguyễn Nhứt Lam',
        'Nguyễn Bảo Ân',
        'Nguyễn Bá Nhiệm',
        'Phan Thị Phương Nam',
        'Nguyễn Khắc Quốc',
        'Võ Thành C',
        'Lê Minh Tự',
        'Khấu Văn Nhựt',
        'Trần Văn Nam',
        'Nguyễn Thừa Phát Tài',
        'Huỳnh Văn Thanh',
        'Nguyễn Hoàng Duy Thiện',
        'Trịnh Quốc Việt',
        'Phạm Minh Đương',
        'Nguyễn Ngọc Đan Thanh',
        'Hà Thị Thúy Vi',
        'Ngô Thanh Huy',
        'Phạm Thị Trúc Mai',
        'Đoàn Phước Miền',
        'Trầm Hoàng Nam',
        'Dương Ngọc Vân Khanh',
        'Nhan Minh Phúc',
        'Nguyễn Mộng Hiền',
        'Thạch Kọng Saoane',
        'Lê Văn Phol',
        'Lê Phong Dũ'
    ]
    // In mảng ra console để kiểm tra

    if (document.getElementById("textdiv")) {
        autocomplete(document.getElementById("textdiv"), Teacher);
    }
    function focusToStart(element) {
        var range = document.createRange();
        var selection = window.getSelection();
        range.setStart(element, 0);
        range.collapse(true);
        selection.removeAllRanges();
        selection.addRange(range);
    }
    function removeUnwantedSpaces(element) {
        element.textContent = element.textContent.trim();
    }

    function autocomplete(inp, arr) {
        var foundSuggestion = false;
        let currentInputValue;
        inp.addEventListener("input", function (e) {
            var a, b, i, val = this.textContent.trim();


            closeAllLists();
            if (!val) {
                return false;
            }
            currentInputValue = val;
            currentFocus = -1;
            a = document.createElement("DIV");
            a.setAttribute("class", "autocomplete-items");
            this.parentNode.appendChild(a);
            // Biến cờ để theo dõi có tìm thấy gợi ý khớp hay không
            const huntran = document.getElementById("huntran");
            for (i = 0; i < arr.length; i++) {
                if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                    b = document.createElement("DIV");
                    b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                    b.innerHTML += arr[i].substr(val.length);
                    b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                    b.addEventListener("click", function (e) {

                        const ConStore = huntran.innerHTML.trim();
                        huntran.innerHTML = ConStore + "&nbsp;" + this.getElementsByTagName("input")[0].value;

                        //huntran.innerHTML = this.getElementsByTagName("input")[0].value;
                        removeAutocompleteContainer()
                        huntran.contentEditable = true;
                        DiChuyenDenCuoi(huntran)
                        foundSuggestion = true;
                        closeAllLists();
                    });
                    a.appendChild(b);
                }
            }

        });

        inp.addEventListener("keydown", function (e) {
            var x = document.getElementsByClassName("autocomplete-items");
            if (x.length > 0) {
                x = x[0].getElementsByTagName("div");

                if (e.keyCode == 40) {
                    currentFocus++;
                    addActive(x);
                } else if (e.keyCode == 38) {
                    currentFocus--;
                    addActive(x);
                } else if (e.keyCode == 13) {
                    e.preventDefault();
                    if (currentFocus > -1) {
                        if (x) x[currentFocus].click();
                        removeAutocompleteContainer();
                    }
                }
            }
            if (e.keyCode == 32 && !foundSuggestion) {
                // alert("hungdeptrai");
                //var inputValue = inp.value;

                if (currentInputValue) {
                    const ConStore = huntran.innerHTML.trim();
                    huntran.innerHTML = ConStore + "&nbsp;" + currentInputValue;
                } else {
                    huntran.innerHTML = ConStore + "&nbsp;"
                }
                console.log(currentInputValue);
                // Lấy giá trị và cập nhật
                huntran.contentEditable = true;
                DiChuyenDenCuoi(huntran)
                removeAutocompleteContainer()
            }
        });
        function removeAutocompleteContainer() {
            var autocompleteContainer = document.querySelector('.autocomplete');

            if (autocompleteContainer) {
                autocompleteContainer.remove();
            }
        }
        function addActive(x) {
            if (!x) return false;
            removeActive(x);
            if (currentFocus >= x.length) currentFocus = 0;
            if (currentFocus < 0) currentFocus = (x.length - 1);
            x[currentFocus].classList.add("autocomplete-active");
        }

        function removeActive(x) {
            for (var i = 0; i < x.length; i++) {
                x[i].classList.remove("autocomplete-active");
            }
        }

        function closeAllLists(elmnt) {
            var x = document.getElementsByClassName("autocomplete-items");
            for (var i = 0; i < x.length; i++) {
                if (elmnt != x[i] && elmnt != inp) {
                    x[i].parentNode.removeChild(x[i]);
                }
            }

        }
        document.addEventListener("click", function (e) {

            closeAllLists(e.target);
        });
    }
   
   function DiChuyenDenCuoi(element) {
        var range = document.createRange();
        var selection = window.getSelection();
        range.selectNodeContents(element);
        range.collapse(false);
        selection.removeAllRanges();
        selection.addRange(range);
    }
</script>