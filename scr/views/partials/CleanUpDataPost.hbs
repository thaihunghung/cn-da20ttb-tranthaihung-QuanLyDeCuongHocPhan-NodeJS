<script>
    function CleanUp_HocPhan() {
        const PhuLuc = document.getElementById('PhuLuc');
        const TenMon = document.getElementById('TenMon');
        const MaMon = document.getElementById('MaMon');
        const SoTC_LT = document.getElementById('SoTC_LT');
        const SoTC_TH = document.getElementById('SoTC_TH');
        const LT = document.getElementById('LT');
        const TH = document.getElementById('TH');
        const TrinhDo_DT = document.getElementById('TrinhDo_DT');
        const SoGioTuHoc = document.getElementById('SoGioTuHoc');
        const ChuyenNganh = document.getElementById('ChuyenNganh');
        const HocKy = document.getElementById('HocKy');
        const NamHoc = document.getElementById('NamHoc');
        const MoTa = document.getElementById('MoTa');
        const LoaiHocPhan = ketquaCheckBox();

        // Kiểm tra và gán giá trị mặc định nếu `textContent` là null
        const phuLucValue = cleanUpString(PhuLuc.textContent) || '';
        const tenMonValue = cleanUpString(TenMon.textContent) || '';
        const maMonValue = cleanUpString(MaMon.textContent) || '';
        const soTCLTValue = cleanUpString(SoTC_LT.textContent) || '';
        const soTCTHValue = cleanUpString(SoTC_TH.textContent) || '';
        const ltValue = cleanUpString(LT.textContent) || '';
        const thValue = cleanUpString(TH.textContent) || '';
        const trinhDoDTValue = cleanUpString(TrinhDo_DT.textContent) || '';
        const soGioTuHocValue = cleanUpString(SoGioTuHoc.textContent) || '';
        const chuyenNganhValue = cleanUpString(ChuyenNganh.textContent) || '';
        const hocKyValue = cleanUpString(HocKy.textContent) || '';
        const namHocValue = cleanUpString(NamHoc.textContent) || '';
        const moTaValue = cleanUpString(MoTa.textContent) || '';
        const LoaiHocPhanValue = cleanUpString(LoaiHocPhan) || '';
        const HocPhanData = {
            PhuLuc: phuLucValue,
            TenMon: tenMonValue,
            MaMon: maMonValue,
            SoTC_LT: soTCLTValue,
            SoTC_TH: soTCTHValue,
            LT: ltValue,
            TH: thValue,
            TrinhDo_DT: trinhDoDTValue,
            SoGioTuHoc: soGioTuHocValue,
            ChuyenNganh: chuyenNganhValue,
            HocKy: hocKyValue,
            NamHoc: namHocValue,
            MoTa: moTaValue,
            LoaiHocPhan: LoaiHocPhanValue
        };

        const jsonString = JSON.stringify(HocPhanData, null, 2);
        console.log(jsonString);
    }
    function CleanUp_AllTaiLieuThamKhao() {
        // Xử lý Giaotrinh
        const giaotrinhContainer = document.getElementById('giaotrinh');
        const giaotrinhItems = Array.from(giaotrinhContainer.getElementsByClassName('giaotrinh'));

        const giaotrinhData = giaotrinhItems.map((item, index) => {
            const key = getKeyTaiLieuByKey('giaotrinh');

            const TG_Element = item.querySelector(`#TG_${key}_${index + 1}`);
            const TG = TG_Element ? cleanUpString(TG_Element.textContent) : '';

            const NXB_Element = item.querySelector(`#NXB_${key}_${index + 1}`);
            const NXB = NXB_Element ? cleanUpString(NXB_Element.textContent) : '';

            const Ten_Element = item.querySelector(`#Ten_${key}_${index + 1}`);
            const Ten = Ten_Element ? cleanUpString(Ten_Element.textContent) : '';

            const NGUON_Element = item.querySelector(`#NGUON_${key}_${index + 1}`);
            const NGUON = NGUON_Element ? cleanUpString(NGUON_Element.textContent) : '';

            const tacGiaArray = TG.split(',').map(author => author.trim());

            return {
                tenTLTK: Ten,
                tacGia: tacGiaArray,
                namXuatBan: NXB,
                loaiHocLieu: 'Giáo trình',
                nguon: NGUON
            };
        });


        // Xử lý TaiLieuThamKhaoData
        const TaiLieuThamKhaoContainer = document.getElementById('TaiLieuThamKhao');
        const TaiLieuThamKhaoItems = Array.from(TaiLieuThamKhaoContainer.getElementsByClassName('TaiLieuThamKhao'));

        const TaiLieuThamKhaoData = TaiLieuThamKhaoItems.map((item, index) => {
            const key = getKeyTaiLieuByKey('TaiLieuThamKhao');

            const TG_Element = item.querySelector(`#TG_${key}_${index + 1}`);
            const TG = TG_Element ? cleanUpString(TG_Element.textContent) : '';

            const NXB_Element = item.querySelector(`#NXB_${key}_${index + 1}`);
            const NXB = NXB_Element ? cleanUpString(NXB_Element.textContent) : '';

            const Ten_Element = item.querySelector(`#Ten_${key}_${index + 1}`);
            const Ten = Ten_Element ? cleanUpString(Ten_Element.textContent) : '';

            const NGUON_Element = item.querySelector(`#NGUON_${key}_${index + 1}`);
            const NGUON = NGUON_Element ? cleanUpString(NGUON_Element.textContent) : '';

            const tacGiaArray = TG.split(',').map(author => author.trim());

            return {
                tenTLTK: Ten,
                tacGia: tacGiaArray,
                namXuatBan: NXB,
                loaiHocLieu: 'Tài liệu tham khảo',
                nguon: NGUON
            };
        });

        // Xử lý HocLieuData
        const HocLieuContainer = document.getElementById('HocLieu');
        const HocLieuItems = Array.from(HocLieuContainer.getElementsByClassName('HocLieu'));

        const HocLieuData = HocLieuItems.map((item, index) => {
            const key = getKeyTaiLieuByKey('HocLieu');

            const TG_Element = item.querySelector(`#TG_${key}_${index + 1}`);
            const TG = TG_Element ? cleanUpString(TG_Element.textContent) : '';

            const NXB_Element = item.querySelector(`#NXB_${key}_${index + 1}`);
            const NXB = NXB_Element ? cleanUpString(NXB_Element.textContent) : '';

            const Ten_Element = item.querySelector(`#Ten_${key}_${index + 1}`);
            const Ten = Ten_Element ? cleanUpString(Ten_Element.textContent) : '';

            const NGUON_Element = item.querySelector(`#NGUON_${key}_${index + 1}`);
            const NGUON = NGUON_Element ? cleanUpString(NGUON_Element.textContent) : '';

            const tacGiaArray = TG.split(',').map(author => author.trim());

            return {
                tenTLTK: Ten,
                tacGia: tacGiaArray,
                namXuatBan: NXB,
                loaiHocLieu: 'Học liệu',
                nguon: NGUON
            };
        });


        const tltkData = {
            "tltkData": {
                "GiaotrinhData": giaotrinhData,
                "TaiLieuThamKhaoData": TaiLieuThamKhaoData,
                "HocLieuData": HocLieuData
            }
        };

        // In ra đối tượng JSON cha
        const prettyJsonStringTLTK = JSON.stringify(tltkData, null, 2);
        console.log('TLTK Data:');
        console.log(prettyJsonStringTLTK);
    }
    function CleanUp_AllTB4() {
        const KyNangKTContainers = document.querySelectorAll('.KyNangKT');
        const KyNangKTdata = Array.from(KyNangKTContainers).map(container => {
            const KT_ND_Element = container.querySelector('.content-4-learning-outcomes-2 .KT');
            const KT_ND = KT_ND_Element ? cleanUpString(KT_ND_Element.textContent) : '';

            const KT_TD_Element = container.querySelector('.content-4-learning-outcomes-4 .KT');
            const KT_TD = KT_TD_Element ? cleanUpString(KT_TD_Element.textContent) : '';

            const KT_TUA_Element = container.querySelector('.content-4-learning-outcomes-5 .KT');
            const KT_TUA = KT_TUA_Element ? cleanUpString(KT_TUA_Element.textContent) : '';

            return {
                loai_CDRMH: 'Về kiến thức',
                Noidung_CDRMH: KT_ND,
                TrinhDo: KT_TD,
                loaiTUA: KT_TUA
            };
        });
        const KyNangKNContainers = document.querySelectorAll('.KyNangKN');
        const KyNangKNdata = Array.from(KyNangKNContainers).map(container => {
            const KT_ND_Element = container.querySelector('.content-4-learning-outcomes-2 .KN');
            const KT_ND = KT_ND_Element ? cleanUpString(KT_ND_Element.textContent) : '';

            const KT_TD_Element = container.querySelector('.content-4-learning-outcomes-4 .KN');
            const KT_TD = KT_TD_Element ? cleanUpString(KT_TD_Element.textContent) : '';

            const KT_TUA_Element = container.querySelector('.content-4-learning-outcomes-5 .KN');
            const KT_TUA = KT_TUA_Element ? cleanUpString(KT_TUA_Element.textContent) : '';

            return {
                loai_CDRMH: 'Về kỹ năng',
                Noidung_CDRMH: KT_ND,
                TrinhDo: KT_TD,
                loaiTUA: KT_TUA
            };
        });

        const KyNangTDContainers = document.querySelectorAll('.KyNangTD');
        const KyNangTDdata = Array.from(KyNangTDContainers).map(container => {
            const KT_ND_Element = container.querySelector('.content-4-learning-outcomes-2 .TD');
            const KT_ND = KT_ND_Element ? cleanUpString(KT_ND_Element.textContent) : '';

            const KT_DUPO_Element = container.querySelector('.content-4-learning-outcomes-3 .TD');
            const KT_DUPO = KT_DUPO_Element ? cleanUpString(KT_DUPO_Element.textContent) : '';

            const KT_TD_Element = container.querySelector('.content-4-learning-outcomes-4 .TD');
            const KT_TD = KT_TD_Element ? cleanUpString(KT_TD_Element.textContent) : '';

            const KT_TUA_Element = container.querySelector('.content-4-learning-outcomes-5 .TD');
            const KT_TUA = KT_TUA_Element ? cleanUpString(KT_TUA_Element.textContent) : '';

            return {
                loai_CDRMH: 'Về thái độ',
                Noidung_CDRMH: KT_ND,
                KT_DUPO: KT_DUPO,
                TrinhDo: KT_TD,
                loaiTUA: KT_TUA
            };
        });

        const CDR_HocPhanData = {
            "CDR_HocPhanData": {
                "KyNangKTdata": KyNangKTdata,
                "KyNangKNdata": KyNangKNdata,
                "KyNangTDdata": KyNangTDdata
            }
        };

        const CDR_HocPhanDataJson = JSON.stringify(CDR_HocPhanData, null, 2);
        console.log('CDR_HocPhan Data:');
        console.log(CDR_HocPhanDataJson);
    }

    function CleanUp_AllTB5() {
        const chuongRows = document.querySelectorAll('.Chuong');
        const chuongData = [];

        chuongRows.forEach((chuongRow, chuongIndex) => {
            const tenChuongElement = chuongRow.querySelector('.TenChuong.STT_CHUONG');
            const gioLyThuyetElement = chuongRow.querySelector('.GioLyThuyet');
            const gioThucHanhElement = chuongRow.querySelector('.GiothucHanh');
            const soGioTuHocElement = chuongRow.querySelector('.SoGioTuHoc');

            const tenChuong = tenChuongElement ? cleanUp2String(tenChuongElement.textContent) : '';
            const gioLyThuyet = gioLyThuyetElement ? cleanUpString(gioLyThuyetElement.textContent) : '';
            const gioThucHanh = gioThucHanhElement ? cleanUpString(gioThucHanhElement.textContent) : '';
            const soGioTuHoc = soGioTuHocElement ? cleanUpString(soGioTuHocElement.textContent) : '';

            const chuong = {
                TenChuong: tenChuong,
                GioLyThuyet: gioLyThuyet,
                GiothucHanh: gioThucHanh,
                SoGioTuHoc: soGioTuHoc,
                KyNangMem: 0,
                ChiTietChuong: []
            };
            // Lấy thông tin KyNangMem từ hàng CuoiChuong
            const kyNangMemRow = document.querySelector(`#CuoiChuong${chuongIndex + 1}`);
            const kyNangMemElement = kyNangMemRow.querySelector('.KyNangMem');
            chuong.KyNangMem = kyNangMemElement ? cleanUpString(kyNangMemElement.textContent) : 0;

            // Lấy các hàng ChiTietChuong của chương hiện tại
            const chiTietChuongRows = document.querySelectorAll(`.ChiTietChuong${chuongIndex + 1} .STT_CTC${chuongIndex + 1}`);
            chiTietChuongRows.forEach(chiTietRow => {
                const sttCTC = chiTietRow ? cleanUpString(chiTietRow.textContent) : '';
                chuong.ChiTietChuong.push(sttCTC);
            });

            chuongData.push(chuong);
        });

        // In ra mảng chuongData để kiểm tra
        console.log(JSON.stringify(chuongData, null, 2));
    }
    function CleaUp_6() {
        const PP_DayHoc = document.getElementById('TenPP');
        const PP_DayHocItems = PP_DayHoc.querySelectorAll('.section-content');
        const phuongPhapGiangDayData = Array.from(PP_DayHocItems).map((item, index) => {
            const tenPhuongPhap = item.querySelector(`span[contenteditable="true"]`);
            const PP_Text = tenPhuongPhap ? cleanUpString(tenPhuongPhap.textContent) : '';
            return {
                TenPP: PP_Text
            };
        });

        // Gộp tất cả các mảng con thành một mảng duy nhất
        const PP_Array = phuongPhapGiangDayData.reduce((acc, item) => {
            return acc.concat(item.TenPP);
        }, []);


        console.log(JSON.stringify(PP_Array, null, 2));
    }

    function CleaUp_7() {
        const quyDinhDataArray = [];

        // Xử lý cho ID 'QD_TD'
        const quyDinhTDItems = document.querySelectorAll('#QD_TD');
        const quyDinhTDArray = Array.from(quyDinhTDItems).map((item, index) => {
            const quyDinhTDElements = item.querySelectorAll('span[contenteditable="true"]');
            const quyDinhTDTextArray = Array.from(quyDinhTDElements).map(quyDinhElement => {
                return cleanUpString(quyDinhElement.textContent) || '';
            });

            return {
                NoiDung: quyDinhTDTextArray
            };
        });
        const allNoiDungTDArray = quyDinhTDArray.reduce((acc, item) => {
            return acc.concat(item.NoiDung);
        }, []);
        quyDinhDataArray.push({
            "NoiDung": allNoiDungTDArray,
            "LoaiQD": 'Quy định về tham dự lớp học'
        });

        // Xử lý cho ID 'QD_HV'
        const quyDinhHVItems = document.querySelectorAll('#QD_HV');
        const quyDinhHVArray = Array.from(quyDinhHVItems).map((item, index) => {
            const quyDinhHVElements = item.querySelectorAll('span[contenteditable="true"]');
            const quyDinhHVTextArray = Array.from(quyDinhHVElements).map(quyDinhElement => {
                return cleanUpString(quyDinhElement.textContent) || '';
            });

            return {
                NoiDung: quyDinhHVTextArray
            };
        });
        const allNoiDungHVArray = quyDinhHVArray.reduce((acc, item) => {
            return acc.concat(item.NoiDung);
        }, []);
        quyDinhDataArray.push({
            "NoiDung": allNoiDungHVArray,
            "LoaiQD": 'Quy định về hành vi trong lớp học'
        });

        // Xử lý cho ID 'QD_HVu'
        const quyDinhHVuItems = document.querySelectorAll('#QD_HVu');
        const quyDinhHVuArray = Array.from(quyDinhHVuItems).map((item, index) => {
            const quyDinhHVuElements = item.querySelectorAll('span[contenteditable="true"]');
            const quyDinhHVuTextArray = Array.from(quyDinhHVuElements).map(quyDinhElement => {
                return cleanUpString(quyDinhElement.textContent) || '';
            });

            return {
                NoiDung: quyDinhHVuTextArray
            };
        });
        const allNoiDungHVuArray = quyDinhHVuArray.reduce((acc, item) => {
            return acc.concat(item.NoiDung);
        }, []);
        quyDinhDataArray.push({
            "NoiDung": allNoiDungHVuArray,
            "LoaiQD": 'Quy định về học vụ'
        });

        // Xuất kết quả
        console.log(JSON.stringify(quyDinhDataArray, null, 2));
    }

    function getKeyTaiLieuByKey(code) {
        if (code === 'giaotrinh') {
            return 'GT';
        } else if (code === 'TaiLieuThamKhao') {
            return 'TL';
        } else if (code === 'HocLieu') {
            return 'HL';
        } else {
            return null;
        }
    }

</script>
{{>StringID}}
{{>CheckBox}}